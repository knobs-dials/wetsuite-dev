''' Testing koop_parse module '''
import os
from wetsuite.helpers.koop_parse import cvdr_parse_identifier, cvdr_meta, cvdr_text, cvdr_sourcerefs
import wetsuite.helpers.etree

def test_cvdr_parse_identifier():
    ' test cvdr_parse_identifier basics '
    assert cvdr_parse_identifier('101404_1')      ==  ('101404', '101404_1')
    assert cvdr_parse_identifier('CVDR101405_1')  ==  ('101405', '101405_1')
    assert cvdr_parse_identifier('CVDR101406')    ==  ('101406',  None     )
    assert cvdr_parse_identifier('1.0:101407_1')  ==  ('101407', '101407_1')

    assert cvdr_parse_identifier('101404_1',     prepend_cvdr=True)  ==  ('CVDR101404', 'CVDR101404_1')
    assert cvdr_parse_identifier('CVDR101405_1', prepend_cvdr=True)  ==  ('CVDR101405', 'CVDR101405_1')
    assert cvdr_parse_identifier('CVDR101406',   prepend_cvdr=True)  ==  ('CVDR101406',  None     )
    assert cvdr_parse_identifier('1.0:101407_1', prepend_cvdr=True)  ==  ('CVDR101407', 'CVDR101407_1')

    # TODO: check about possible edge cases, like leading zeroes


#def test_cvdr_param_parse():
#    pass

#filedata = '''<?xml version="1.0" encoding="utf-8"?><cvdr xmlns="http://standaarden.overheid.nl/cvdr/terms/" xmlns:dcterms="http://purl.org/dc/terms/" xmlns:overheid="http://standaarden.overheid.nl/owms/terms/" xmlns:overheidrg="http://standaarden.overheid.nl/cvdr/meta/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://standaarden.overheid.nl/cvdr/terms/  http://decentrale.regelgeving.overheid.nl/cvdr/xsd/cvdr.xsd"><!--export0.92--><meta xmlns:msxsl="urn:schemas-microsoft-com:xslt" xmlns:xhtml="http://www.w3.org/1999/xhtml"><owmskern><dcterms:identifier>CVDR621050_2</dcterms:identifier><dcterms:title>Verordening van de raad, het college van burgemeester en wethouders en de burgemeester over de taken en bevoegdheden van de commissie bezwaarschriften (Verordening commissie bezwaarschriften Heemstede 2022)</dcterms:title><dcterms:language>nl</dcterms:language><dcterms:type scheme="overheid:Informatietype">regeling</dcterms:type><dcterms:creator scheme="overheid:Gemeente">Heemstede</dcterms:creator><dcterms:modified>2022-07-16</dcterms:modified></owmskern><owmsmantel><dcterms:isFormatOf resourceIdentifier="https://zoek.officielebekendmakingen.nl/gmb-2022-324550">gmb-2022-324550</dcterms:isFormatOf><dcterms:alternative>Verordening commissie bezwaarschriften Heemstede 2022</dcterms:alternative><dcterms:source resourceIdentifier="1.0:c:BWBR0005537&amp;artikel=7%3A13&amp;g=2019-01-01">artikel 7:13 van de Algemene wet bestuursrecht</dcterms:source><overheid:isRatifiedBy scheme="overheid:BestuursorgaanGemeente">college van burgemeester en wethouders</overheid:isRatifiedBy><dcterms:subject>bestuur en recht</dcterms:subject><dcterms:issued>2022-05-10</dcterms:issued><dcterms:rights>De tekst in dit document is vrij van auteursrecht en databankrecht</dcterms:rights></owmsmantel><cvdripm><overheidrg:inwerkingtredingDatum>2022-07-16</overheidrg:inwerkingtredingDatum><overheidrg:terugwerkendekrachtDatum>2022-05-01</overheidrg:terugwerkendekrachtDatum><overheidrg:betreft>titel, aanhef, artikel 2, 21</overheidrg:betreft><overheidrg:kenmerk>1026113</overheidrg:kenmerk><overheidrg:redactioneleToevoeging><al>Deze regeling is tevens vastgesteld door de gemeenteraad en de burgemeester.</al><al>De aanhef en citeertitel van deze regeling zijn gewijzigd. </al></overheidrg:redactioneleToevoeging></cvdripm></meta><body><intitule>Verordening van de raad, het college van burgemeester en wethouders en de burgemeester over de taken en bevoegdheden van de commissie bezwaarschriften (Verordening commissie bezwaarschriften Heemstede 2022)</intitule><regeling><aanhef><preambule><al>De raad, het college en de burgemeester van de gemeente Heemstede;</al><al>ieder voor zover het hun bevoegdheden betreft;</al><al>gelezen het voorstel van het college van 17 november 2015, 18 december 2018 en 10 mei 2022;</al><al>gelet op artikel 7:13 van de Algemene wet bestuursrecht (Awb);</al><al/><al>besluiten vast te stellen de volgende verordening:</al><al/><al>Verordening commissie bezwaarschriften Heemstede 2022</al></preambule></aanhef><regeling-tekst><artikel><kop><label>Artikel</label><nr>1</nr><titel>Begripsbepalingen</titel></kop><al>In deze verordening wordt verstaan onder:</al><lid><lidnr>a.</lidnr><al>college: het college van burgemeester en wethouders;</al></lid><lid><lidnr>b.</lidnr><al>commissie: vaste commissie van advies voor de bezwaarschriften;</al></lid><lid><lidnr>c.</lidnr><al>verwerend orgaan: bestuursorgaan dat het bestreden besluit heeft genomen;</al></lid><lid><lidnr>d.</lidnr><al>wet: Algemene wet bestuursrecht</al></lid><al/></artikel><artikel><kop><label>Artikel 2 Reikwijdte advisering</label></kop><lid><lidnr>1.</lidnr><al>De commissie adviseert de raad, het college en de burgemeester ten aanzien van de beslissing op bezwaarschriften.</al></lid><lid><lidnr>2.</lidnr><al>De commissie is niet bevoegd te adviseren over bezwaarschriften, die zijn ingediend tegen besluiten; en</al><lijst><li nr="a."><al>op grond van een wettelijk voorschrift inzake belastingen;</al></li><li nr="b."><al>op grond van de Wet waardering onroerende zaken;</al></li><li nr="c."><al>betreffende personele aangelegenheden; en</al></li><li nr="d."><al>als bedoeld in artikel 7.3, derde lid, van de Wet open overheid.</al></li></lijst></lid></artikel><artikel><kop><label>Artikel</label><nr>3</nr><titel>Samenstelling van de commissie</titel></kop><lid><lidnr>1.</lidnr><al>De commissie bestaat uit een voorzitter en tenminste twee leden.</al></lid><lid><lidnr>2.</lidnr><al>De voorzitter en de leden worden door het college benoemd, geschorst en ontslagen.</al></lid><lid><lidnr>3.</lidnr><al>De commissie regelt de vervanging van de voorzitter en de inroostering van de leden.</al></lid><lid><lidnr>4.</lidnr><al>De voorzitter en de leden kunnen geen deel uitmaken van of werkzaam zijn onder verantwoordelijkheid van het bestuursorgaan.</al></lid></artikel><artikel><kop><label>Artikel</label><nr>4</nr><titel>Secretaris</titel></kop><al>Het college wijst het secretariaat van de commissie aan. </al><al/></artikel><artikel><kop><label>Artikel</label><nr>5</nr><titel>Zittingsduur</titel></kop><lid><lidnr>1.</lidnr><al>De voorzitter en de leden worden benoemd voor een termijn van vier jaar. Het is mogelijk één keer herbenoemd te worden.</al></lid><lid><lidnr>2.</lidnr><al>Het college kan besluiten, ter waarborging van de continuïteit van de werkzaamheden van de commissie, de voorzitter of een lid voor de tweede keer te herbenoemen. Het college kan daarbij een kortere termijn van herbenoemen vaststellen.</al></lid><lid><lidnr>3.</lidnr><al>De voorzitter en de leden kunnen op elk moment ontslag nemen. Zij doen daarvan schriftelijk mededeling aan het college.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>6</nr><titel>Ingediend bezwaarschrift</titel></kop><al>Het bezwaarschrift met de daarbij behorende stukken wordt na ontvangst binnen een week in handen van de commissie gesteld.</al><al/></artikel><artikel><kop><label>Artikel</label><nr>7</nr><titel>Uitoefening bevoegdheden</titel></kop><lid><lidnr>1.</lidnr><al>De bevoegdheden ingevolge de hierna genoemde artikelen van de wet worden voor de toepassing van deze verordening uitgeoefend door de voorzitter.</al><lijst><li nr="a."><al>artikel 2:1, tweede lid;</al></li><li nr="b."><al>artikel 6:6, wat betreft de indiener stellen onder termijn;</al></li><li nr="c."><al>artikel 6:17, voor zover het de verzending van stukken betreft tijdens de behandeling door de commissie;</al></li><li nr="d."><al>artikel 7:4, tweede lid;</al></li><li nr="e."><al>artikel 7:6, vierde lid.</al></li></lijst></lid><lid><lidnr>2.</lidnr><al>De voorzitter kan de uitoefening van deze bevoegdheden, met uitzondering van de bevoegdheid ingevolge artikel 7:6, vierde lid, van de wet opdragen aan de secretaris.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>8</nr><titel>Vooronderzoek</titel></kop><lid><lidnr>1.</lidnr><al>De voorzitter is bevoegd rechtstreeks alle gewenst inlichtingen in te winnen of te laten inwinnen.</al></lid><lid><lidnr>2.</lidnr><al>De voorzitter kan uit eigen beweging of op verlangen van de commissie bij deskundigen advies of inlichtingen inwinnen en hen zo nodig uitnodigen daartoe op de hoorzitting te verschijnen. Indien daaraan kosten zijn verbonden, is vooraf machtiging van het college vereist.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>9</nr><titel>Hoorzitting</titel></kop><lid><lidnr>1.</lidnr><al>De voorzitter bepaalt de plaats en tijdstip van de zitting waarin de belanghebbenden en het verwerend orgaan in de gelegenheid worden gesteld door de commissie te worden gehoord.</al></lid><lid><lidnr>2.</lidnr><al>De voorzitter beslist over de toepassing van artikel 7:3 van de wet.</al></lid><lid><lidnr>3.</lidnr><al>Indien de voorzitter op grond van het tweede lid besluit af te zien van het horen, doet hij daarvan mededeling aan de belanghebbenden en het verwerend orgaan.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>10</nr><titel>Uitnodiging zitting</titel></kop><lid><lidnr>1.</lidnr><al>De voorzitter nodigt de belanghebbenden en het verwerend orgaan ten minste twee weken voor de zitting schriftelijk uit.</al></lid><lid><lidnr>2.</lidnr><al>De belanghebbenden of het verwerend orgaan kunnen onder opgaaf van redenen de voorzitter verzoeken het tijdstip van de zitting te wijzigen.</al></lid><lid><lidnr>3.</lidnr><al>De beslissing van de voorzitter op dit verzoek wordt voor het tijdstip van de zitting aan de belanghebbenden en het verwerend orgaan meegedeeld.</al></lid><lid><lidnr>4.</lidnr><al>De voorzitter is bevoegd in bijzondere omstandigheden af te wijken van het eerste tot en met het derde lid.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>11</nr><titel>Quorum</titel></kop><al>Voor het houden van een zitting is vereist dat tenminste twee leden, onder wie in ieder geval de voorzitter of zijn plaatsvervanger, aanwezig is.</al><al/></artikel><artikel><kop><label>Artikel</label><nr>12</nr><titel>Niet-deelneming aan de behandeling</titel></kop><al>De voorzitter en de leden nemen niet deel aan de behandeling van een bezwaarschrift indien daarbij hun onpartijdigheid in het geding kan zijn. Zij laten zich zo nodig vervangen.</al><al/></artikel><artikel><kop><label>Artikel</label><nr>13</nr><titel>Openbaarheid zitting</titel></kop><lid><lidnr>1.</lidnr><al>De zitting van de commissie is openbaar.</al></lid><lid><lidnr>2.</lidnr><al>De deuren kunnen worden gesloten indien de voorzitter of een van de aanwezige leden het nodig oordeelt of indien een belanghebbende daartoe een verzoek doet.</al></lid><lid><lidnr>3.</lidnr><al>De commissie besluit, indien gewichtige redenen aanwezig zijn die zich tegen openbaarheid van de zitting verzetten, dat de zitting achter gesloten deuren plaatsvindt.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>14</nr><titel>Schriftelijke verslaglegging</titel></kop><lid><lidnr>1.</lidnr><al>Het verslag, als bedoeld in artikel 7:7 van de wet, vermeldt de namen van de aanwezigen en hun hoedanigheid.</al></lid><lid><lidnr>2.</lidnr><al>Het verslag is een korte zakelijke weergave van hetgeen ter zitting aan de orde is geweest.</al></lid><lid><lidnr>3.</lidnr><al>Het verslag verwijst naar de op de zitting overgelegde stukken.</al></lid><lid><lidnr>4.</lidnr><al>De voorzitter of bij diens afwezigheid een van de tijdens de hoorzitting aanwezige leden en de secretaris ondertekenen het verslag.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>15</nr><titel>Nader onderzoek</titel></kop><lid><lidnr>1.</lidnr><al>Indien na afloop van de zitting maar voordat het advies wordt opgesteld, nader onderzoek wenselijk is, kan de voorzitter uit eigen beweging of op verlangen van de leden dit onderzoek houden.</al></lid><lid><lidnr>2.</lidnr><al>De uit het nader onderzoek verkregen informatie wordt in afschrift aan de leden, het verwerend orgaan en de belanghebbenden toegezonden.</al></lid><lid><lidnr>3.</lidnr><al>De leden, het verwerend orgaan en de belanghebbenden kunnen binnen een week na verzending van de nadere informatie aan de voorzitter verzoeken een nieuwe hoorzitting te beleggen. De voorzitter beslist op dit verzoek.</al></lid><lid><lidnr>4.</lidnr><al>Op een nieuwe hoorzitting zijn de bepalingen in deze verordening die betrekking hebben op de hoorzitting, zo veel mogelijk van overeenkomstige toepassing.</al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>16</nr><titel>Raadkamer en advies</titel></kop><lid><lidnr>1.</lidnr><al>De commissie beraadslaagt en beslist achter gesloten deuren over het door haar uit te brengen advies.</al></lid><lid><lidnr>2.</lidnr><al>De commissie beslist bij meerderheid van stemmen over het uit te brengen advies. Indien bij een stemming de stemmen staken, beslist de stem van de voorzitter. Van een minderheidsstandpunt wordt bij het advies melding gemaakt indien de minderheid dat verlangt.</al></lid><lid><lidnr>3.</lidnr><al>Het advies is gemotiveerd en omvat een voorstel voor de te nemen beslissing op het bezwaarschrift.</al></lid><lid><lidnr>4.</lidnr><al>De voorzitter of bij diens afwezigheid een van de tijdens de hoorzitting aanwezige leden en de secretaris ondertekenen het advies. </al></lid><al/></artikel><artikel><kop><label>Artikel</label><nr>17</nr><titel>Uitbrengen advies</titel></kop><al>Het advies wordt samen met het verslag en eventueel door de commissie ontvangen nadere informatie, tijdig uitgebracht aan het bestuursorgaan dat de beslissing op bezwaar neemt.</al><al/></artikel><artikel><kop><label>Artikel</label><nr>18</nr><titel>Jaarverslag</titel></kop><al>De commissie brengt jaarlijks voor 1 juli aan de bestuursorganen van de gemeente verslag uit van haar werkzaamheden in het voorafgaande kalenderjaar.</al><al/></artikel><artikel><kop><label>Artikel</label><nr>19</nr><titel>Intrekking oude regeling</titel></kop><al>De Verordening commissie bezwaarschriften, vastgesteld door de raad op 27 mei 2010 vastgesteld, wordt ingetrokken.</al><al/></artikel><artikel><kop><label>Artikel</label><nr>20</nr><titel>Inwerkingtreding</titel></kop><al>Deze verordening treedt in werking op de achtste dag na bekendmaking.</al><al/></artikel><artikel><kop><label>Artikel</label><nr>21</nr><titel>Citeertitel</titel></kop><al>Deze verordening wordt aangehaald als: Verordening commissie bezwaarschriften Heemstede 2022.</al></artikel></regeling-tekst><regeling-sluiting><!--ontbrekende slotformulering die wel verplicht is in CVDR dus leeg neergezet--><slotformulering><al/></slotformulering><ondertekening><functie>Vastgesteld door het college op 17 november 2015 en gewijzigd op 18 december 2018.</functie><functie>Vastgesteld door de burgemeester op 17 november 2015 en gewijzigd op 18 december 2018.</functie><functie>Vastgesteld door de raad op 28 januari 2016 en gewijzigd op 31 januari 2019.</functie></ondertekening></regeling-sluiting></regeling></body></cvdr>'''


def read_testdata():
    ' open a test file placed in the test directory - probably works unless something is being very protective '
    import test_koop_parse
    file = open( os.path.join( os.path.dirname( test_koop_parse.__file__ ), 'cvdr_example.xml'), mode='rb' )
    filedata = file.read()
    file.close()
    return filedata


def test_etree():
    ' read test data with read_testdata(), parse and return as etree object'
    return wetsuite.helpers.etree.fromstring( read_testdata() )


def test_cvdr_meta():
    ' test cvdr_meta, mostly just for not borking out immediately '
    tree = test_etree()

    meta = cvdr_meta(tree)
    assert isinstance( meta['issued'], list ) # i.e. not flattened

    meta = cvdr_meta(tree, flatten=True)
    assert meta['identifier'] == 'CVDR621050_2' # a value as expected


def test_cvdr_text():
    ' test cvdr_text, currently just for not borking out immediately '
    tree = test_etree()
    cvdr_text(tree)


def test_cvdr_sourcerefs():
    ' test cvdr_text, currently just for not borking out immediately '
    tree = test_etree()
    cvdr_sourcerefs(tree)


# TODO:
# bwb_searchresult_meta

# bwb_toestand_usefuls

# bwb_wti_usefuls

# cvdr_versions_for_work


# alineas_with_selective_path

# merge_alinea_data

# merge_alinea_data
